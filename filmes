const { application } = require("express")
const { update } = require("lodash")

var movie1 = {
  Title: "A Trip To The Moon",
  Description: "At a meeting of the Astronomy Club, its president, Professor Barbenfouillis, proposes an expedition to the Moon. After addressing some dissent, five other brave astronomers—Nostradamus, Alcofrisbas, Omega, Micromegas, and Parafaragaramus—agree to the plan. A space capsule in the shape of a bullet is built with a huge cannon to shoot it into space. The astronomers embark and their capsule is fired from the cannon with the help of marines, most of whom are played by young women in sailor\’s outfits. The Man in the Moon watches the capsule as it approaches, and, in an iconic shot, it hits him in the eye",
  ReleaseYear: "1902",
  Genre: {
    Name: "Adventure",
    Description: "An adventure film is a form of adventure fiction, and is a genre of film. Subgenres of adventure films include swashbuckler films, pirate films, and survival films. Adventure films may also be combined with other film genres such as action, animation, comedy, drama, fantasy, science fiction, family, horror, or war."
  },
  Director: {
    Name: "Georges Melies",
    Bio: "Marie-Georges-Jean Melies was a French illusionist, actor, and film director. He led many technical and narrative development\’s in the earliest days of cinema.",
    Birth: new Date("1861-12-08"),
    Death: new Date("1938-01-21"),
  },
  ImagePath: "https://m.media-amazon.com/images/M/MV5BMzcyYzhlMzctYjg1NS00ODJlLTkxOTUtYmQ4YjgxMWY5MGFlXkEyXkFqcGdeQXVyNDE5MTU2MDE@._V1_.jpg",
  	
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "Meshes of the Afternoon",
    Description: "A woman sees someone on the street as she is walking back to her home. She goes to her room and sleeps on a chair. As soon as she is asleep, she experiences a dream in which she repeatedly tries to chase a mysterious hooded figure with a mirror for a face but cannot catch it. With each failure, she re-enters her house and sees numerous household objects including a key, a bread knife, a flower, a telephone, and a phonograph.",
    ReleaseYear: "1943",
    Genre: {
        Name: "Fantasy ",
        Description: "Fantasy films are films that belong to the fantasy genre with fantastic themes, usually magic, supernatural events, mythology, folklore, or exotic fantasy worlds. The genre is considered a form of speculative fiction alongside science fiction films and horror films, although the genres do overlap."
    },
    Director: {
        Name: "Maya Deren",
        Bio: "Maya Deren was a Ukrainian-born American experimental filmmaker and important promoter of the avant-garde in the 1940s and 1950s. Deren was also a choreographer, dancer, film theorist, poet, lecturer, writer, and photographer.",
        Birth: new Date("1917-05-12"),
        Death: new Date("1961-10-13"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BYzI0ODY4MTgtNjcxZC00Njk5LWI4MjQtZWRhMzU0ZjgwNDlmXkEyXkFqcGdeQXVyNDE5MTU2MDE@._V1_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "The Great Train Robbery",
    Description: "Among the earliest existing films in American cinema - notable as an early film to present a narrative story to tell - it depicts a group of outlaws who hold up a train and rob the passengers. A Sheriff's posse then pursues them. Several scenes have color included - all hand tinted.",
    ReleaseYear: "1903",
    Genre: {
        Name: "Western",
        Description: "Western is a literature, film, and television genre. Westerns are primarily set in the American Old West between the late eighteenth century and late nineteenth century and tell the stories of cowboys, settlers, and outlaws exploring the western frontier and taming the Wild West.",
    },
    Director: {
        Name: "Edwin S. Porter",
        Bio: "In the late 1890s Porter worked as both a projectionist and mechanic, eventually becoming director and cameraman for the Edison Manufacturing Company. Influenced by both the Brighton school and the story films of Georges Melies",
        Birth: new Date("1870-04-21"),
        Death: new Date("1941-04-30"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BYjZmNTUwY2ItMzZlNy00NWY0LWJjNTMtMGZiYzRiYWY2ZTFhXkEyXkFqcGdeQXVyNDE5MTU2MDE@._V1_FMjpg_UX1000_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "Un Chien Andalou",
    Description: "In a surrealistic film with input from Salvador Dalí, director Luis Buñuel presents stark, surrealistic images including the slitting open of a woman's eye and a dead horse being pulled along on top of a piano. A mysterious film open to interpretations ranging from deep to completely meaningless, this short (17-minute) film certainly presented something new in the cinema of its day.",
    ReleaseYear: "1929",
    Genre: {
        Name: "Horror",
        Description: "Horror films may incorporate incidents of physical violence and psychological terror; they may be studies of deformed, disturbed, psychotic, or evil characters; stories of terrifying monsters or malevolent animals; or mystery thrillers that use atmosphere to build suspense.",
    },
    Director: {
        Name: "Luis Buñuel",
        Bio: "The father of cinematic Surrealism and one of the most original directors in the history of the film medium, Luis Buñuel was given a strict Jesuit education (which sowed the seeds of his obsession with both religion and subversive behavior), and subsequently moved to Madrid to study at the university there, where his close friends included Salvador Dalí and Federico García Lorca.",
        Birth: new Date("1900-02-22"),
        Death: new Date("1983-07-29"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BMjZlY2RjM2ItZGEwOC00ODQwLWFhZDYtMjE3ODMyYWNiOWNlXkEyXkFqcGdeQXVyNTA4NzY1MzY@._V1_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "Night and Fog",
    Description: "One of the most vivid depictions of the horrors of Nazi Concentration Camps. Filmed in 1955 at several concentration camps in Poland, the film combines new color and black and white footage with black and white newsreels, footage shot by the victorious allies, and stills, to tell the story not only of the camp\’s, but to portray the horror of man's brutal inhumanity.",
    ReleaseYear: "1956",
    Genre: {
        Name: "Documentary",
        Description: "Documentary is a film or video examining an event or person based on facts. The word can also refer to anything involving documents."
    },
    Director: {
        Name: "Alain Resnais",
        Bio: "Alain Resnais was a French film director and screenwriter whose career extended over more than six decades. After training as a film editor in the mid-1940s, he went on to direct a number of short films which included Night and Fog, an influential documentary about the Nazi concentration camps.",
        Birth: new Date("1922-06-03"),
        Death: new Date("2014-03-01"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BZmUzMDBjMTctMWFkNy00YTZlLWJjYjgtMzcwYjFjOGUwMDczXkEyXkFqcGdeQXVyMTMxODk2OTU@._V1_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "Scorpio Rising",
    Description: "A gang of Nazi bikers prepares for a race as sexual, sadistic, and occult images are cut together.",
    ReleaseYear: "1963",
    Genre: {
        Name: "Music",
        Description: "A music genre is a conventional category that identifies some pieces of music as belonging to a shared tradition or set of conventions. It is to be distinguished from musical form and musical style, although in practice these terms are sometimes used interchangeably."
    },
    Director: {
        Name: "Kenneth Anger",
        Bio: "Kenneth Anger grew up in Hollywood and started out as a child actor, but his interest in filmmaking was evident at an early age: he made his first film, Who Has Been Rocking My Dreamboat - 1941, at age 9. Anger developed into one of the pioneers of the American underground film movement. His gritty, violent, often homosexual-themed films were too strong for American audiences of the time, and many of his productions were filmed in Europe, mainly France. However, Anger is best known for authoring the landmark Hollywood Babylon books.",
        Birth: new Date("1927-02-03"),
    },
    ImagePath: "https://image.tmdb.org/t/p/w780/fs9QDvOzOpZCaa2rv1U57jAFfYU.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "Wavelength",
    Description: "Claimed by some to be one of the most unconventional and experimental films ever made, Wavelength is a structural film of a 45-minute long zoom-in on a window over a period of a week. Very unconventional and experimental, indeed.",
    ReleaseYear: "1967",
    Genre: {
        Name: "Drama",
        Description: "Drama is a category or genre of narrative fiction (or semi-fiction) intended to be more serious than humorous in tone."
    },
    Director: {
        Name: "Michael Snow",
        Bio: "Michael Snow CC RCA (born December 10, 1928) is a Canadian artist working in a range of media including film, installation, sculpture, photography, and music. His best-known films are Wavelength (1967) and La Région Centrale (1971), with the former regarded as a milestone in avant-garde cinema.",
        Birth: new Date("1928-12-10"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BMDFhZTcxMmUtYTYwMS00NGVkLWE1YTEtYWIxN2M4ZTdmN2VmXkEyXkFqcGdeQXVyMjUyNDk2ODc@._V1_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "The House Is Black",
    Description: "Set in a leper colony in the north of Iran, The House is Black juxtaposes 'ugliness', of which there is much in the world as stated in the opening scenes, with religion and gratitude.",
    ReleaseYear: "1963",
    Genre: {
        Name: "Documentary",
        Description: "Documentary is a film or video examining an event or person based on facts. The word can also refer to anything involving documents."
    },
    Director: {
        Name: "Forugh Farrokhzad",
        Bio: "Farugh Farrokhzad was primarily a poet. Indeed, she is regarded as one of the most important poets of the twentieth century in Iran, which has a millennium of poetic tradition behind it. Although she only made one film, the 22-minute so-called documentary 'The House is Black', this work is generally seen as the crucial precursor of the Iranian New Wave.",
        Birth: new Date("1935-01-05"),
        Death: new Date("1967-02-13"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BOGIyODcyMDUtZWI0Zi00ZDcwLWJlOTktNTJkNjI1MzVmN2Q4XkEyXkFqcGdeQXVyODU1OTc0MzI@._V1_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "A Day in the Country",
    Description: "During a summer afternoon, Parisian merchant Monsieur Dufour takes his extended family out to the countryside for some rest and relaxation. On their outing, the Dufour party meets two locals at an inn, and the young men offer to take the women boating while the father and his future son-in-law go fishing. But, before long, engaged Henriette Dufour falls for her guide, Henri, and a new romance begins.",
    ReleaseYear: "1936",
    Genre: {
        Name: "Comedy",
        Description: "Comedy is a genre of fiction that consists of discourses or works intended to be humorous or amusing by inducing laughter, especially in theatre, film, stand-up comedy, television, radio, books, or any other entertainment medium. The term originated in ancient Greece: in Athenian democracy, the public opinion of voters was influenced by political satire performed by comic poets in theaters."
    },
    Director: {
        Name: "Jean Renoir",
        Bio: "Son of the famous Impressionist painter Pierre Auguste, he had a happy childhood. Pierre Renoir was his brother, and Claude Renoir was his nephew. After the end of World War I, where he won the Croix de Guerre, he moved from scriptwriting to filmmaking. He married Catherine Hessling, for whom he began to make movies; he wanted to make a star of her. They separated in 1930, although he remained married to her until 1943. His next partner was Marguerite Renoir, whom he never married, although she took his name. He left France in 1941 during the German invasion of France during World War II and became a naturalized US citizen.",
        Birth: new Date("1894-09-15"),
        Death: new Date("1979-02-12"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BMTFmMzgwMWEtMDVlNy00MDdhLWJjODEtZjU3MTY3MzhhMjZmXkEyXkFqcGdeQXVyNjI5NTk0MzE@._V1_FMjpg_UX1000_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "La Jetée",
    Description: "The story of a man forced to explore his memories in the wake of World War III's devastation, told through still images.",
    ReleaseYear: "1962",
    Genre: {
        Name: "Sci-Fi",
        Description: "Science fiction (sometimes shortened to Sci-Fi or SF) is a genre of speculative fiction which typically deals with imaginative and futuristic concepts such as advanced science and technology, space exploration, time travel, parallel universes, extraterrestrial life, sentient artificial intelligence, cybernetics, certain forms of immortality (like mind uploading), and the singularity. Science fiction predicted several existing inventions, such as the atomic bomb, robots and Borazon, whose names entirely match their fictional predecessors."
    },
    Director: {
        Name: "Chris Marker",
        Bio: "Chris Marker was born in Neuilly-sur-Seine, Hauts-de-Seine, France. He was a director and writer, known for 12 Monkeys (1995), Sans Soleil (1983), and Third Side of the Coin (1960). He died in 2012 in Paris, France.",
        Birth: new Date("1921-07-29"),
        Death: new Date("2012-07-29"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BODgyNzEyMzEtZjUyOC00YzNiLWE2YTAtNDQ1MzQ0NmY5YjA2XkEyXkFqcGdeQXVyMTA0MTM5NjI2._V1_FMjpg_UX1000_.jpg",
}
db.movies.insertOne(movie1)


var movie1 = {
    Title: "A Grin Without a Cat",
    Description: "The film features many interviews with French communist leaders, students, and sociologists. The Prague Spring of 1968 is featured, with footage of a Fidel Castro speech in which he explains his political support for the Soviet invasion of Czechoslovakia while questioning the legality of the action. Other sections deal with the Vietnam War, the guerrilla war in Bolivia, the rise of Salvador Allende, Minamata poisoning in Japan, and the Watergate Scandal in the US. There are many subtle references to cats throughout the film, as well as brief shots of raccoons.",
    ReleaseYear: "1977",
    Genre: {
        Name: "Documentary",
        Description: "Documentary is a film or video examining an event or person based on facts. The word can also refer to anything involving documents."
    },
    Director: {
        Name: "Chris Marker",
        Bio: "Chris Marker was born in Neuilly-sur-Seine, Hauts-de-Seine, France. He was a director and writer, known for 12 Monkeys (1995), Sans Soleil (1983), and Third Side of the Coin (1960). He died in 2012 in Paris, France.",
        Birth: new Date("1921-07-29"),
        Death: new Date("2012-07-29"),
    },
    ImagePath: "https://m.media-amazon.com/images/M/MV5BMDcwMGI1ZGUtYmZiYS00YmUwLWJjYWQtNDE5NzU5MjVmZWE0XkEyXkFqcGdeQXVyMzIwNDY4NDI@._V1_.jpg",
    Featured: true
}
db.movies.insertOne(movie1)

var user1 = {
    Username: "Silvio",
    Password: "123321",
    Email: "silvio@teste.com",
    Birthday: new Date("1990-01-01"),
    FavoriteMovies: [],
}
db.users.insertOne(user1)


db.users.updateOne(
    { _id: ObjectId("63779d09e170a930ad3609bd") },
    { $set: { Birthday: new Date("1990-01-01")}}
  )

db.users.update(
    { _id: ObjectId("63779d09e170a930ad3609bd") },
    { $set: {Birthday: "new Date("1990-01-01")"} }
    )

var user1 = {
    Username: "User 2",
    Password: "123321",
    Email: "u2@teste.com",
    Birthday: "1990-01-01",
    FavoriteMovies: [],
}
db.users.insertOne(user1)

db.movies.find(
    { "Director.Name": "Chris Marker"}
)


var user1 = {
    Username: "User 3",
    Password: "123321",
    Email: "u3@teste.com",
    Birthday: "2000-01-01",
    FavoriteMovies: [],
}
db.users.insertOne(user1)

var user1 = {
    Username: "User 4",
    Password: "123321",
    Email: "u4@teste.com",
    Birthday: "2000-01-01",
    FavoriteMovies: [],
}
db.users.insertOne(user1)

var user1 = {
    Username: "User 5",
    Password: "1233222",
    Email: "u5@teste.com",
    Birthday: "2000-01-01",
    FavoriteMovies: [],
}
db.users.insertOne(user1)

update
db.movies.updateOne(
    { _id: ObjectId("6378bec406fe7db189f956ed")},
    { $set: {Description: "Gotta wacht it! A surrealistic film with input from Salvador Dalí, director Luis Buñuel presents stark, surrealistic images including the slitting open of a woman\'s eye and a dead horse being pulled along on top of a piano."}})


db.movies.update(
        [condition of which items to update],
          { $push: { name of key to add value to end of array] : [value to add to end of array ] } }
) 


db.movies.update(
        { _id: ObjectId("6378bec406fe7db189f956ed") },
        { $push: { Actors: ["Simone Mareuil", "Salvador Dalí"] } }
)

db.users.update(
        { _id: ObjectId("6378befb06fe7db189f956f5")},
        { $push: { FavoriteMovies: ObjectId("6378bec406fe7db189f956ed")}}
)

db.users.deleteOne( {"Username": "User 4"})

FILMES /movies /director /Title /Genre
//When at /Movies
app.get("/movies", (req,res) => {
    Movies.find()
    .then((movies) => {
        res.json(movies);
    })
    .catch((err) => {
        console.error(err);
        res.status(500).send("Error: " + err);
    });
});

//info about director when looking for a director
app.get("/director/:Name", (req,res) => {
    Directors.findOne({ Name: req.params.Name})
    .then((director) => {
        res.json(director);
    })
    .catch((err) => {
        console.error(err);
        res.status(500).send("Error: " + err);
    });
});

//Get Json movie looking for a title
app.get("/movies/:Title", (req,res) => {
    Movies.findOne({ Title: req.params.Title})
    .then((movie) => {
        res.json(movie);
    })
    .catch((err) => {
        console.error(err);
        res.status(500).send("Error: " + err);
    });
});

//Json genre info when looking for a genre
app.get("/genre/:Name", (req,res) =>{
    Genres.findOne({Name: req.params.Name })
    .then((genre) =>{
        res.json(genre.Description);
    })
    .catch((err) =>{
        console.error(err);
        res.status(500).send("Error: " +err);
    });
});


Usuarios
app.get("/users", function (req,res) {
    Users.find()
    .then(function(users) {
        res.status(201).json(users);
    })
    .catch(function(err) {
        console.error(err);
        res.status(500).send("Error: " +err);
    });
});

//allow users to register
app.post('/users', (req, res) => {
    Users.findOne({ Username: req.body.Username })
    .then((user) => {
      if (user) {
        return res.status(400).send(req.body.Username + ' already exists');
      } else {
        Users
        .create({
          Username: req.body.Username,
          Password: req.body.Password,
          Email: req.body.Email,
          Birthday: req.body.Birthday
        })
        .then((user) =>{res.status(201).json(user) })
        .catch((error) => {
          console.error(error);
          res.status(500).send('Error: ' + error);
        })
      }
    })
    .catch((error) => {
      console.error(error);
      res.status(500).send('Error: ' + error);
    });
  });